{
  "createdAt": "2025-07-23T11:53:32.550Z",
  "updatedAt": "2025-07-23T15:23:21.000Z",
  "id": "AUd1W5LsSlGeRKJX",
  "name": "Lesson Image Creator",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "lms-image-generator",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "9948b3e5-35b0-4bc0-ac9b-4c2faae2b24f",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1184,
        480
      ],
      "webhookId": "d284e6eb-ae65-4561-9c5e-621076c78399"
    },
    {
      "parameters": {
        "operation": "get",
        "filters": {
          "conditions": [
            {}
          ]
        }
      },
      "id": "3bd6d469-ded5-4cf9-8454-99ad2bbd218d",
      "name": "Hent Lesson",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -992,
        480
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "filters": {
          "conditions": [
            {},
            {}
          ]
        }
      },
      "id": "ba73fbf4-5b6b-4e66-867c-746089b72743",
      "name": "Hent Lektionsindhold",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -784,
        368
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "filters": {
          "conditions": [
            {}
          ]
        }
      },
      "id": "2ff2507f-e8a4-49ed-8191-7e9ff078b47a",
      "name": "Hent Module",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -784,
        480
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "filters": {
          "conditions": [
            {},
            {}
          ]
        }
      },
      "id": "a190374b-fa0a-4db3-a9b4-ddd4ebca32f1",
      "name": "Hent Modulindhold",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -592,
        480
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "filters": {
          "conditions": [
            {}
          ]
        }
      },
      "id": "ae112abb-8cd5-483c-b560-cb18eaab34cd",
      "name": "Hent Kursus",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -384,
        480
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "filters": {
          "conditions": [
            {},
            {}
          ]
        }
      },
      "id": "ef85d868-424a-4131-9d82-ed9bf2b3e97a",
      "name": "Hent Kursusindhold",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -192,
        480
      ]
    },
    {
      "parameters": {
        "jsCode": "// Saml al data fra de forskellige nodes\nconst lessonData = $node['get_lesson_translation'].json[0];\nconst moduleData = $node['get_module_translation'].json[0];\nconst courseData = $node['get_course_translation'].json[0];\nconst webhookData = $node['Webhook Trigger'].json;\n\nreturn {\n  lesson_id: webhookData.lesson_id,\n  image_type: webhookData.image_type || 'illustration',\n  lesson_title: lessonData.title,\n  lesson_content: lessonData.content,\n  module_title: moduleData.title,\n  module_description: moduleData.description,\n  course_title: courseData.title,\n  course_description: courseData.description\n};"
      },
      "id": "a9e047ba-8905-4615-9bb8-cc2cc71bc905",
      "name": "Saml Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16,
        480
      ]
    },
    {
      "parameters": {},
      "id": "594e3bcd-8c44-4b30-97a1-a95f6b4e325d",
      "name": "Generer Billedbeskrivelse",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1.3,
      "position": [
        224,
        480
      ],
      "credentials": {}
    },
    {
      "parameters": {
        "jsCode": "const aiResponse = JSON.parse($input.first().json.message.content);\n\nreturn {\n  image_prompt: aiResponse.image_prompt,\n  image_text: aiResponse.image_text,\n  lesson_id: $node['combine_data'].json.lesson_id\n};"
      },
      "id": "c79182dd-0ffb-4c9b-87d5-8b418a3cbf75",
      "name": "Parse AI Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        416,
        480
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.replicate.com/v1/predictions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Token {{ $credentials.apiToken }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"version\": \"black-forest-labs/flux-1.1-pro\",\n  \"input\": {\n    \"prompt\": \"{{ $json.image_prompt }}, professional quality, high resolution, clean design, modern aesthetics\",\n    \"aspect_ratio\": \"16:9\",\n    \"output_format\": \"png\",\n    \"output_quality\": 90,\n    \"safety_tolerance\": 2,\n    \"prompt_upsampling\": true\n  }\n}",
        "options": {}
      },
      "id": "0212095f-f051-4c1a-9b3e-6b6f839b5eba",
      "name": "Generer Billede med Flux",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        624,
        480
      ]
    },
    {
      "parameters": {
        "resume": "webhook",
        "options": {
          "webhookSuffix": "={{ $json.id }}"
        }
      },
      "id": "9e2f4fcd-3db0-4355-9ad8-f51b4a575a9d",
      "name": "Vent p√• Billede",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        816,
        480
      ],
      "webhookId": "image-ready-webhook"
    },
    {
      "parameters": {
        "url": "={{ $json.output[0] }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "id": "f2679bab-6067-405f-ab7e-7313995c56a8",
      "name": "Download Billede",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1024,
        480
      ]
    },
    {
      "parameters": {
        "jsCode": "const lessonId = $node['parse_ai_response'].json.lesson_id;\nconst timestamp = Date.now();\nconst fileName = `lesson_${lessonId}_${timestamp}.png`;\n\nreturn {\n  fileName: fileName,\n  bucketName: 'lms-images',\n  lesson_id: lessonId,\n  image_text: $node['parse_ai_response'].json.image_text\n};"
      },
      "id": "aad11b5e-bd04-4b26-a9c3-3e241175cce9",
      "name": "Forbered Upload",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1216,
        480
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $credentials.url }}/storage/v1/object/{{ $json.bucketName }}/{{ $json.fileName }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $credentials.serviceKey }}"
            },
            {
              "name": "Content-Type",
              "value": "image/png"
            }
          ]
        },
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "image/png",
        "options": {}
      },
      "id": "b61cd136-c529-4c6c-8d8d-498608dc30b4",
      "name": "Upload til Supabase Storage",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1424,
        480
      ]
    },
    {
      "parameters": {
        "jsCode": "const uploadData = $node['prepare_upload'].json;\nconst supabaseUrl = $node['upload_to_storage'].parameters.url.split('/storage')[0];\n\nreturn {\n  image_url: `${supabaseUrl}/storage/v1/object/public/${uploadData.bucketName}/${uploadData.fileName}`,\n  image_text: uploadData.image_text,\n  lesson_id: uploadData.lesson_id\n};"
      },
      "id": "b741d823-340b-4fe7-b4a3-5056ec11be9b",
      "name": "Byg Public URL",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1616,
        480
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "filters": {
          "conditions": [
            {
              "condition": "eq"
            },
            {
              "condition": "eq"
            }
          ]
        }
      },
      "id": "27a38ac0-4384-4919-980a-4259420d7872",
      "name": "Opdater Lesson Translation",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1824,
        480
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": true,\n  \"lesson_id\": \"{{ $json.lesson_id }}\",\n  \"image_url\": \"{{ $json.image_url }}\",\n  \"image_text\": \"{{ $json.image_text }}\",\n  \"message\": \"Billede genereret og gemt succesfuldt\"\n}",
        "options": {
          "responseCode": 200
        }
      },
      "id": "770abf73-6e73-4593-ba00-d9b3c9eaa3ce",
      "name": "Send Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        2016,
        480
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": false,\n  \"error\": \"{{ $json.error.message || 'En uventet fejl opstod' }}\",\n  \"lesson_id\": \"{{ $node['Webhook Trigger'].json.lesson_id }}\"\n}",
        "options": {
          "responseCode": 500
        }
      },
      "id": "6a722bb1-b0d3-4872-9c4e-efe25b902801",
      "name": "Error Handler",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1824,
        672
      ]
    }
  ],
  "connections": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "a9d98c28-f471-4c9e-ab6f-d0f07e5be005",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-07-23T11:53:32.558Z",
      "updatedAt": "2025-07-23T11:53:32.558Z",
      "role": "workflow:owner",
      "workflowId": "AUd1W5LsSlGeRKJX",
      "projectId": "SFLNAzqJIfhKMhJx"
    }
  ],
  "tags": []
}