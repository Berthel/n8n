{
  "updatedAt": "2025-05-18T11:47:46.000Z",
  "createdAt": "2025-03-16T14:51:34.643Z",
  "id": "bdGJ5CNAKozZfzo0",
  "name": "Create Content Agent 5",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "operation": "sendAndWait",
        "sendTo": "flemming.berthelsen@gmail.com",
        "subject": "Content approval required",
        "message": "=shortDescription:\n{{ $json.output.shortDescription }}\n\n\nintroduction:\n{{ $json.output.introduction }}\n\n\nmainStory:\n{{ $json.output.mainStory }}\n\n\nacademicBackground:\n{{ $json.output.academicBackground }}\n\n",
        "responseType": "customForm",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Action",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "Publish"
                  },
                  {
                    "option": "Reject"
                  },
                  {
                    "option": "Change"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Message",
              "fieldType": "textarea"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        176,
        -475
      ],
      "id": "9b7d133e-2ac6-4311-8492-c688b024fa53",
      "name": "Gmail",
      "webhookId": "6428e462-a83b-4fd8-8569-10caefe288be",
      "credentials": {
        "gmailOAuth2": {
          "id": "XI6wZVsQczyW63ra",
          "name": "Gmail account 2"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        484,
        -255
      ],
      "id": "262fbb84-7f41-4050-9da5-3ee9807d457e",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "ZjiR1Y4tdzymEK1L",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "eb91541b-0154-471c-aff3-87d1959e7a36",
              "name": "output.shortDescription",
              "value": "={{ $json.output.shortDescription }}",
              "type": "string"
            },
            {
              "id": "e324dd71-776f-452c-b0a8-cb9231ae1799",
              "name": "output.introduction",
              "value": "={{ $json.output.introduction }}",
              "type": "string"
            },
            {
              "id": "87845a90-24e8-41c4-a9e7-39817d749d19",
              "name": "output.mainStory",
              "value": "={{ $json.output.mainStory }}",
              "type": "string"
            },
            {
              "id": "e1d52e83-645a-4fc5-ae8f-f375bc2382bd",
              "name": "output.academicBackground",
              "value": "={{ $json.output.academicBackground }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -264,
        -350
      ],
      "id": "771bd546-bdcc-4aca-b835-fb9b5dc55b64",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "inputText": "=Classify this response: {{ $json.data.Action }}",
        "categories": {
          "categories": [
            {
              "category": "Publish",
              "description": "If human response is Publish"
            },
            {
              "category": "Reject",
              "description": "If human response is Reject"
            },
            {
              "category": "Change",
              "description": "If human response is Change"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1,
      "position": [
        396,
        -475
      ],
      "id": "e0d27afb-1e57-498e-8d71-40cca8cc36ff",
      "name": "Check Feedback"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=shortDescription:  {{ $('Edit Fields1').item.json.output.shortDescription }}\n\nintroduction: {{ $('Edit Fields1').item.json.output.introduction }}\n\nmainStory: {{ $('Edit Fields1').item.json.output.mainStory }}\n\nacademicBackground: {{ $('Edit Fields1').item.json.output.academicBackground }}\n\nhumanFeedback: {{ $json.data.Message }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=# Role\nYou are a Content Revision Specialist. Your objective is to refine AI-generated historical content based on human feedback while strictly adhering to the original creation guidelines and preserving the intended style, structure, and factual integrity.\n\n# Instructions\n1. Retain the core meaning and factual accuracy of the original content.\n2. Ensure the language and style remain accessible and appealing to cultural travelers aged 45-70.\n3. Incorporate user feedback only where it does not conflict with the original guidelines.\n\n# Critical Rules\n- Maintain all original place names (e.g., \"K√∏benhavn\", \"S√£o Jorge\").\n- Keep the exact JSON structure and preserve all HTML tags.\n- Retain the original section word counts (¬±10% margin).\n- Do not introduce any new or speculative information. If user feedback cannot be verified with provided data, use \"[REDACTED]\" instead.\n- Continue to uphold the previously defined ratio of verified facts to cultural narratives and readability levels.\n- Follow SEO keyword usage only if included in the original text; do not add new keywords.\n\n# Workflow\nYou will receive these elements:\n  \"shortDescription\": [Content Creator‚Äôs output],\n  \"introduction\": [Content Creator‚Äôs output],\n  \"mainStory\": [Content Creator‚Äôs output],\n  \"academicBackground\": [Content Creator‚Äôs output],\n  \"humanFeedback\": [User‚Äôs revision requests]\n\n\nYour tasks:\n1. Compare user feedback with the original text.\n2. Apply changes that comply with the original content guidelines.\n3. Preserve all HTML formatting (e.g., <h2>, <h3>, <ul>, <li>, <b>) and ensure the timeline structure remains intact.\n4. Avoid adding or removing major content sections beyond minor adjustments (within ¬±10% word count).\n\n# Required Output\nReturn your revised content in the EXACT same JSON format:\n{\n  \"shortDescription\": \"\",\n  \"introduction\": \"\",\n  \"mainStory\": \"\",\n  \"academicBackground\": \"\"\n}\n\nOutput ONLY the JSON object with the revised text. No explanations or additional commentary beyond the JSON object.\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        772,
        -250
      ],
      "id": "f47c2bc5-3b70-40f2-af60-b68710a02546",
      "name": "Content Revision"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "IpVMGwXt5TmcAzUd",
          "mode": "list",
          "cachedResultName": "Heritage Navigator ‚Äî Insert Description Agent"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "global_code": "={{ $('Get Site').item.json.global_code }}",
            "shortDescription": "={{ $('Edit Fields1').first().json.output.shortDescription }}",
            "overview": "={{ $('Edit Fields1').first().json.output.introduction }}",
            "mainStory": "={{ $('Edit Fields1').first().json.output.mainStory }}",
            "academicBackground": "={{ $('Edit Fields1').first().json.output.academicBackground }}",
            "site_id": "={{ $('site').item.json.site_id }}",
            "city_id": "={{ $('site').item.json.city_id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "global_code",
              "displayName": "global_code",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "site_id",
              "displayName": "site_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "city_id",
              "displayName": "city_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "shortDescription",
              "displayName": "shortDescription",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "overview",
              "displayName": "overview",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "mainStory",
              "displayName": "mainStory",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "academicBackground",
              "displayName": "academicBackground",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        850,
        -700
      ],
      "id": "003fa1bc-f4a0-417e-9b4e-f18ac61f6d80",
      "name": "Publish"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        850,
        -500
      ],
      "id": "bb82ab7e-bca8-4cd1-bcbc-6092fd239c5a",
      "name": "Rejected"
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "2f120009-4370-4e54-a3d6-9325ba432881",
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -972,
        870
      ],
      "credentials": {
        "openAiApi": {
          "id": "ZjiR1Y4tdzymEK1L",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"shortDescription\": {\n      \"type\": \"string\",\n      \"description\": \"A concise summary of the historical site to hook the reader (max 60 characters).\"\n    },\n    \"introduction\": {\n      \"type\": \"string\",\n      \"description\": \"This introduction section is an introduction and an appetizer. This section begins with <h2>Introduction</h2> and contains 60-80 words in English, formatted in HTML with <p> tags. Flesch-Kincaid ‚â§ 8 readability in this section\"\n    },\n    \"mainStory\": {\n      \"type\": \"string\",\n      \"description\": \"This section is narrative and engaging. This main story section that starts with <h2>Historic Highlights</h2> and includes 300-500 words of detailed historical and cultural content in English. The content should be formatted in HTML using paragraphs (<p>), bold (<b>), italic (<i>), and additional subsections for readability. Include at least one memorable anecdote per 200 words if you got any from the research material. Context-rich opening paragraph linking chronology and culture  \\n\\n**Quality Requirements** \\n- Maintain 80:20 ratio of verified facts to cultural narratives  \\n- Apply Flesch-Kincaid Grade Level 8-10 readability     \\n \\n\\n**Formatting Rules in mainStory** \\n- Use <b>bold</b> section headers with emoji prefixes (üè∞ üé® ‚õ™ üé≠ ‚öîÔ∏è üåü) \\n- Apply responsive content chunks (max 150 words each)\\n- Include 2-4 pull quotes from notable sources formatted in <blockquote>  \\n\\nExamples:\\n\\nüè∞ <b>Architectural Crossroads</b> \\nThe 14th-century keep demonstrates rare <i>opus mixtum</i> construction (alternating brick/stone)...  \\n\\n\\nüé≠ <b>Cultural Contradictions</b> \\n1521 Reformation clashes left...  \\n\\nüí° <b>Visitor Tip</b> \\nThe south tower's \\\"Laughing Gargoyle\\\" inspired local festival traditions...  \\n\\n...\\nüåü\\n<blockquote>\\n  <p>‚ÄúA precious synthesis of over two centuries of official Roman art.‚Äù</p>\\n  <cite>‚Äî Italian commentator, Archival Records</cite>\\n</blockquote> [additional sections] Flesch-Kincaid 9-11 readability in this section\"\n    },\n    \"academicBackground\": {\n      \"type\": \"string\",\n      \"description\": \"An academic background section that begins with <h2>Timeline & Context</h2> followed by <h4>Historical Timeline</h4>. It must include a <ul> list of key historical dates and events formatted as list items (<li>) with bolded periods, and contain 400-800 words in English, using HTML formatting. This section is more fact-based and more precisely formulated than the mainStory section, and contains academic background knowledge. Don't repeat things from mainStory, but make background information for people who are interested in a deeper knowledge. Flesch-Kincaid 11-12 readability in this section\"\n    }\n  },\n  \"required\": [\n    \"shortDescription\",\n    \"introduction\",\n    \"mainStory\",\n    \"academicBackground\"\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -460,
        -140
      ],
      "id": "c42342a6-697e-4160-85a7-6cf47e745e4b",
      "name": "Structured Output Parser1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1300,
        670
      ],
      "id": "2c3c8cad-ec2a-4276-be87-bac2eb91c8f1",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "7oESUrXOypaiYfq2",
          "name": "openrouter"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatInput }}",
        "options": {
          "systemMessage": "=# Rolle\nDu er en hj√¶lpsom assistent der kommunikerer med brugeren p√• dansk.\n\n# V√¶rkt√∏jer\n## user_documents\nVector Store med alle dokumenter\n\n## List Documents\nViser en liste over de dokumenter vi har til r√•dighed. Ud fra navnet kan du hente hele dokumentet med Get File Contents\nHvis du ikke finder svar i user_documents skal du lede her\nBrug denne metode hvis filnavnet indikerer at du kan finde svar p√• et sp√∏rgsm√•l i dokumentet\n\n## Get File Contents\nHenter hele dokumentet p√• basis af filnavnet\n\n\n# Regler\nDu m√• kun formidle den viden du kan f√• gennem v√¶rkt√∏jerne og ikke videregive din egen viden.\nHvis viden ikke er tilg√¶ngelig i v√¶rkt√∏jerne kan du blot fort√¶lle det til brugeren"
        }
      },
      "id": "5faeff00-4548-4d46-83c3-01fc7cb9b8ca",
      "name": "RAG AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -1268,
        450
      ]
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1520,
        450
      ],
      "id": "6642becf-c156-4d4e-a4fa-e6385c26cff7",
      "name": "When chat message received",
      "webhookId": "53769069-bf2e-499e-9318-be0db240453b",
      "disabled": true
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -1180,
        670
      ],
      "id": "82c350cc-f6f4-42d1-b11b-53d82408416a",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "EzZYFEVPXxVDpNLe",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "user_documents",
        "toolDescription": "Vector Store with a large collection of verified documents",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 40,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        -1060,
        672.5
      ],
      "id": "347d5414-fd2c-4ece-9f5a-1901525951a5",
      "name": "user_documents",
      "credentials": {
        "supabaseApi": {
          "id": "1Yc1VOr8K1yXCO1Q",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "markdownToHtml",
        "markdown": "={{ $('Get Site').first().json.research }}",
        "options": {}
      },
      "type": "n8n-nodes-base.markdown",
      "typeVersion": 1,
      "position": [
        -44,
        -475
      ],
      "id": "a5b467f1-1171-48ff-a075-74eb1a37f603",
      "name": "Research HTML"
    },
    {
      "parameters": {
        "name": "monumentos_portugal",
        "description": "Query this tool to get knowledge of buildings and monuments only. Call the tool by the name of the buildin/monument and the city name to get response from http://www.monumentos.gov.pt/ - the official Portuguese source for information about monuments",
        "workflowId": {
          "__rl": true,
          "value": "y3SEoNbyzFsiZXtw",
          "mode": "list",
          "cachedResultName": "My project ‚Äî Content Monumentos Portugal"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        -1520,
        910
      ],
      "id": "3ca45fe3-b74a-42d5-a959-0d177107fede",
      "name": "monumentos_portugal"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.name }} in {{ $('Get Sitename').first().json.city_id.toTitleCase() }}\n\n\n# Main research\n{{ $('Get Site').first().json.research }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=# Role \nAs chief editor integrated with Heritage Navigator, synthesize multi-agent inputs into a unified narrative that balances academic depth with public accessibility, optimized for our target demographics (cultural tourists 45-70, educators, and local history enthusiasts).\nYou need to prioritize which topics from the research you want to emphasize in order to create a story that is as engaging as possible for the target audience.\nOnly use the knowledge from the provided research material. Don't use your own knowled about the subject.\n\n**Friendly and Engaging**\nUse a warm, welcoming style that treats the reader like a valued guest.\nKeep sentences shorter and use inclusive language such as ‚Äúwe‚Äù and ‚Äúus‚Äù to build rapport.\nEncourage curiosity about historical or cultural details without overwhelming the reader with jargon.\nUse direct calls to action when relevant, like ‚ÄúDiscover,‚Äù ‚ÄúExplore,‚Äù or ‚ÄúImmerse yourself.‚Äù\nEngage emotions by highlighting the human stories behind the facts.\n\n# Input  \nIn-depth historical research \n\n# Output Specifications  \n_A multi-format narrative containing the sections:_  \n\n\n# Output Format\nYour final output must be a valid JSON object"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        -640,
        -350
      ],
      "id": "76095179-56ea-48aa-b0f0-6fece0f112f4",
      "name": "Editor1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "=anthropic/claude-3.7-sonnet",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -600,
        220
      ],
      "id": "a1595741-6800-46aa-b419-b46192d08e6c",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "7oESUrXOypaiYfq2",
          "name": "openrouter"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "site_translations",
        "filters": {
          "conditions": [
            {
              "keyName": "site_id",
              "keyValue": "={{ $('site').item.json.site_id }}"
            },
            {
              "keyName": "language_code",
              "keyValue": "en"
            },
            {
              "keyName": "city_id",
              "keyValue": "={{ $json.city_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -860,
        -350
      ],
      "id": "6950a807-8180-45ba-a89e-42a70853451b",
      "name": "Get Sitename",
      "credentials": {
        "supabaseApi": {
          "id": "1Yc1VOr8K1yXCO1Q",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f005e12b-7a72-4f7d-b4ed-a652a82e5688",
              "name": "site_id",
              "value": "={{ $json.site_id }}",
              "type": "string"
            },
            {
              "id": "fb770e5a-4a1a-4025-be59-3da22bf93564",
              "name": "city_id",
              "value": "rome",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1300,
        -350
      ],
      "id": "676e830f-93ad-4a59-93ac-f0e91e8a41cf",
      "name": "site"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "sites",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $json.site_id }}"
            },
            {
              "keyName": "city_id",
              "keyValue": "={{ $json.city_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1080,
        -350
      ],
      "id": "225895ea-0df6-4538-bfbd-d83286958bc2",
      "name": "Get Site",
      "credentials": {
        "supabaseApi": {
          "id": "1Yc1VOr8K1yXCO1Q",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "claude-3-5-sonnet-20241022",
          "mode": "list",
          "cachedResultName": "Claude 3.5 Sonnet (New)"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.3,
      "position": [
        -620,
        -60
      ],
      "id": "71c1acbe-fcb3-437d-b854-989a657cd1c8",
      "name": "Anthropic Chat Model1",
      "credentials": {
        "anthropicApi": {
          "id": "ADl7Wvu9YXxKvVtY",
          "name": "Anthropic account 2"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -780,
        -100
      ],
      "id": "b2605515-16af-4dc2-af10-6615a8d58892",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "ZjiR1Y4tdzymEK1L",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "site_id"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1500,
        -600
      ],
      "id": "a1fdd9ff-ca08-463e-8db5-ec3dac2e2292",
      "name": "When Executed by Another Workflow"
    }
  ],
  "connections": {
    "Gmail": {
      "main": [
        [
          {
            "node": "Check Feedback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Check Feedback",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Research HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Feedback": {
      "main": [
        [],
        [
          {
            "node": "Rejected",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Content Revision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Content Revision": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "user_documents",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Content Revision",
            "type": "ai_outputParser",
            "index": 0
          },
          {
            "node": "Editor1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "RAG AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "RAG AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "RAG AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "user_documents": {
      "ai_tool": [
        [
          {
            "node": "RAG AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "monumentos_portugal": {
      "ai_tool": [
        []
      ]
    },
    "Editor1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Research HTML": {
      "main": [
        [
          {
            "node": "Publish",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Content Revision",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get Sitename": {
      "main": [
        [
          {
            "node": "Editor1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "site": {
      "main": [
        [
          {
            "node": "Get Site",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Site": {
      "main": [
        [
          {
            "node": "Get Sitename",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Anthropic Chat Model1": {
      "ai_languageModel": [
        []
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Editor1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "site",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "site_id": "ara-pacis"
        }
      }
    ]
  },
  "versionId": "923da71e-b94c-4f74-a817-8418d565b647",
  "activeVersionId": "923da71e-b94c-4f74-a817-8418d565b647",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-03-16T14:51:34.647Z",
      "createdAt": "2025-03-16T14:51:34.647Z",
      "role": "workflow:owner",
      "workflowId": "bdGJ5CNAKozZfzo0",
      "projectId": "rkqKISKa14HwF9Xd"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-01-11T05:15:49.904Z",
    "createdAt": "2026-01-11T05:15:49.904Z",
    "versionId": "923da71e-b94c-4f74-a817-8418d565b647",
    "workflowId": "bdGJ5CNAKozZfzo0",
    "nodes": [
      {
        "parameters": {
          "operation": "sendAndWait",
          "sendTo": "flemming.berthelsen@gmail.com",
          "subject": "Content approval required",
          "message": "=shortDescription:\n{{ $json.output.shortDescription }}\n\n\nintroduction:\n{{ $json.output.introduction }}\n\n\nmainStory:\n{{ $json.output.mainStory }}\n\n\nacademicBackground:\n{{ $json.output.academicBackground }}\n\n",
          "responseType": "customForm",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Action",
                "fieldType": "dropdown",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "Publish"
                    },
                    {
                      "option": "Reject"
                    },
                    {
                      "option": "Change"
                    }
                  ]
                },
                "requiredField": true
              },
              {
                "fieldLabel": "Message",
                "fieldType": "textarea"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          176,
          -475
        ],
        "id": "9b7d133e-2ac6-4311-8492-c688b024fa53",
        "name": "Gmail",
        "webhookId": "6428e462-a83b-4fd8-8569-10caefe288be",
        "credentials": {
          "gmailOAuth2": {
            "id": "XI6wZVsQczyW63ra",
            "name": "Gmail account 2"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          484,
          -255
        ],
        "id": "262fbb84-7f41-4050-9da5-3ee9807d457e",
        "name": "OpenAI Chat Model1",
        "credentials": {
          "openAiApi": {
            "id": "ZjiR1Y4tdzymEK1L",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "eb91541b-0154-471c-aff3-87d1959e7a36",
                "name": "output.shortDescription",
                "value": "={{ $json.output.shortDescription }}",
                "type": "string"
              },
              {
                "id": "e324dd71-776f-452c-b0a8-cb9231ae1799",
                "name": "output.introduction",
                "value": "={{ $json.output.introduction }}",
                "type": "string"
              },
              {
                "id": "87845a90-24e8-41c4-a9e7-39817d749d19",
                "name": "output.mainStory",
                "value": "={{ $json.output.mainStory }}",
                "type": "string"
              },
              {
                "id": "e1d52e83-645a-4fc5-ae8f-f375bc2382bd",
                "name": "output.academicBackground",
                "value": "={{ $json.output.academicBackground }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -264,
          -350
        ],
        "id": "771bd546-bdcc-4aca-b835-fb9b5dc55b64",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "inputText": "=Classify this response: {{ $json.data.Action }}",
          "categories": {
            "categories": [
              {
                "category": "Publish",
                "description": "If human response is Publish"
              },
              {
                "category": "Reject",
                "description": "If human response is Reject"
              },
              {
                "category": "Change",
                "description": "If human response is Change"
              }
            ]
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.textClassifier",
        "typeVersion": 1,
        "position": [
          396,
          -475
        ],
        "id": "e0d27afb-1e57-498e-8d71-40cca8cc36ff",
        "name": "Check Feedback"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=shortDescription:  {{ $('Edit Fields1').item.json.output.shortDescription }}\n\nintroduction: {{ $('Edit Fields1').item.json.output.introduction }}\n\nmainStory: {{ $('Edit Fields1').item.json.output.mainStory }}\n\nacademicBackground: {{ $('Edit Fields1').item.json.output.academicBackground }}\n\nhumanFeedback: {{ $json.data.Message }}",
          "hasOutputParser": true,
          "messages": {
            "messageValues": [
              {
                "message": "=# Role\nYou are a Content Revision Specialist. Your objective is to refine AI-generated historical content based on human feedback while strictly adhering to the original creation guidelines and preserving the intended style, structure, and factual integrity.\n\n# Instructions\n1. Retain the core meaning and factual accuracy of the original content.\n2. Ensure the language and style remain accessible and appealing to cultural travelers aged 45-70.\n3. Incorporate user feedback only where it does not conflict with the original guidelines.\n\n# Critical Rules\n- Maintain all original place names (e.g., \"K√∏benhavn\", \"S√£o Jorge\").\n- Keep the exact JSON structure and preserve all HTML tags.\n- Retain the original section word counts (¬±10% margin).\n- Do not introduce any new or speculative information. If user feedback cannot be verified with provided data, use \"[REDACTED]\" instead.\n- Continue to uphold the previously defined ratio of verified facts to cultural narratives and readability levels.\n- Follow SEO keyword usage only if included in the original text; do not add new keywords.\n\n# Workflow\nYou will receive these elements:\n  \"shortDescription\": [Content Creator‚Äôs output],\n  \"introduction\": [Content Creator‚Äôs output],\n  \"mainStory\": [Content Creator‚Äôs output],\n  \"academicBackground\": [Content Creator‚Äôs output],\n  \"humanFeedback\": [User‚Äôs revision requests]\n\n\nYour tasks:\n1. Compare user feedback with the original text.\n2. Apply changes that comply with the original content guidelines.\n3. Preserve all HTML formatting (e.g., <h2>, <h3>, <ul>, <li>, <b>) and ensure the timeline structure remains intact.\n4. Avoid adding or removing major content sections beyond minor adjustments (within ¬±10% word count).\n\n# Required Output\nReturn your revised content in the EXACT same JSON format:\n{\n  \"shortDescription\": \"\",\n  \"introduction\": \"\",\n  \"mainStory\": \"\",\n  \"academicBackground\": \"\"\n}\n\nOutput ONLY the JSON object with the revised text. No explanations or additional commentary beyond the JSON object.\n"
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.5,
        "position": [
          772,
          -250
        ],
        "id": "f47c2bc5-3b70-40f2-af60-b68710a02546",
        "name": "Content Revision"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "IpVMGwXt5TmcAzUd",
            "mode": "list",
            "cachedResultName": "Heritage Navigator ‚Äî Insert Description Agent"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "global_code": "={{ $('Get Site').item.json.global_code }}",
              "shortDescription": "={{ $('Edit Fields1').first().json.output.shortDescription }}",
              "overview": "={{ $('Edit Fields1').first().json.output.introduction }}",
              "mainStory": "={{ $('Edit Fields1').first().json.output.mainStory }}",
              "academicBackground": "={{ $('Edit Fields1').first().json.output.academicBackground }}",
              "site_id": "={{ $('site').item.json.site_id }}",
              "city_id": "={{ $('site').item.json.city_id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "global_code",
                "displayName": "global_code",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "site_id",
                "displayName": "site_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "city_id",
                "displayName": "city_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string",
                "removed": false
              },
              {
                "id": "shortDescription",
                "displayName": "shortDescription",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "overview",
                "displayName": "overview",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "mainStory",
                "displayName": "mainStory",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "academicBackground",
                "displayName": "academicBackground",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.2,
        "position": [
          850,
          -700
        ],
        "id": "003fa1bc-f4a0-417e-9b4e-f18ac61f6d80",
        "name": "Publish"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          850,
          -500
        ],
        "id": "bb82ab7e-bca8-4cd1-bcbc-6092fd239c5a",
        "name": "Rejected"
      },
      {
        "parameters": {
          "model": "text-embedding-3-small",
          "options": {}
        },
        "id": "2f120009-4370-4e54-a3d6-9325ba432881",
        "name": "Embeddings OpenAI1",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1,
        "position": [
          -972,
          870
        ],
        "credentials": {
          "openAiApi": {
            "id": "ZjiR1Y4tdzymEK1L",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"shortDescription\": {\n      \"type\": \"string\",\n      \"description\": \"A concise summary of the historical site to hook the reader (max 60 characters).\"\n    },\n    \"introduction\": {\n      \"type\": \"string\",\n      \"description\": \"This introduction section is an introduction and an appetizer. This section begins with <h2>Introduction</h2> and contains 60-80 words in English, formatted in HTML with <p> tags. Flesch-Kincaid ‚â§ 8 readability in this section\"\n    },\n    \"mainStory\": {\n      \"type\": \"string\",\n      \"description\": \"This section is narrative and engaging. This main story section that starts with <h2>Historic Highlights</h2> and includes 300-500 words of detailed historical and cultural content in English. The content should be formatted in HTML using paragraphs (<p>), bold (<b>), italic (<i>), and additional subsections for readability. Include at least one memorable anecdote per 200 words if you got any from the research material. Context-rich opening paragraph linking chronology and culture  \\n\\n**Quality Requirements** \\n- Maintain 80:20 ratio of verified facts to cultural narratives  \\n- Apply Flesch-Kincaid Grade Level 8-10 readability     \\n \\n\\n**Formatting Rules in mainStory** \\n- Use <b>bold</b> section headers with emoji prefixes (üè∞ üé® ‚õ™ üé≠ ‚öîÔ∏è üåü) \\n- Apply responsive content chunks (max 150 words each)\\n- Include 2-4 pull quotes from notable sources formatted in <blockquote>  \\n\\nExamples:\\n\\nüè∞ <b>Architectural Crossroads</b> \\nThe 14th-century keep demonstrates rare <i>opus mixtum</i> construction (alternating brick/stone)...  \\n\\n\\nüé≠ <b>Cultural Contradictions</b> \\n1521 Reformation clashes left...  \\n\\nüí° <b>Visitor Tip</b> \\nThe south tower's \\\"Laughing Gargoyle\\\" inspired local festival traditions...  \\n\\n...\\nüåü\\n<blockquote>\\n  <p>‚ÄúA precious synthesis of over two centuries of official Roman art.‚Äù</p>\\n  <cite>‚Äî Italian commentator, Archival Records</cite>\\n</blockquote> [additional sections] Flesch-Kincaid 9-11 readability in this section\"\n    },\n    \"academicBackground\": {\n      \"type\": \"string\",\n      \"description\": \"An academic background section that begins with <h2>Timeline & Context</h2> followed by <h4>Historical Timeline</h4>. It must include a <ul> list of key historical dates and events formatted as list items (<li>) with bolded periods, and contain 400-800 words in English, using HTML formatting. This section is more fact-based and more precisely formulated than the mainStory section, and contains academic background knowledge. Don't repeat things from mainStory, but make background information for people who are interested in a deeper knowledge. Flesch-Kincaid 11-12 readability in this section\"\n    }\n  },\n  \"required\": [\n    \"shortDescription\",\n    \"introduction\",\n    \"mainStory\",\n    \"academicBackground\"\n  ]\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          -460,
          -140
        ],
        "id": "c42342a6-697e-4160-85a7-6cf47e745e4b",
        "name": "Structured Output Parser1"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -1300,
          670
        ],
        "id": "2c3c8cad-ec2a-4276-be87-bac2eb91c8f1",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "7oESUrXOypaiYfq2",
            "name": "openrouter"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.chatInput }}",
          "options": {
            "systemMessage": "=# Rolle\nDu er en hj√¶lpsom assistent der kommunikerer med brugeren p√• dansk.\n\n# V√¶rkt√∏jer\n## user_documents\nVector Store med alle dokumenter\n\n## List Documents\nViser en liste over de dokumenter vi har til r√•dighed. Ud fra navnet kan du hente hele dokumentet med Get File Contents\nHvis du ikke finder svar i user_documents skal du lede her\nBrug denne metode hvis filnavnet indikerer at du kan finde svar p√• et sp√∏rgsm√•l i dokumentet\n\n## Get File Contents\nHenter hele dokumentet p√• basis af filnavnet\n\n\n# Regler\nDu m√• kun formidle den viden du kan f√• gennem v√¶rkt√∏jerne og ikke videregive din egen viden.\nHvis viden ikke er tilg√¶ngelig i v√¶rkt√∏jerne kan du blot fort√¶lle det til brugeren"
          }
        },
        "id": "5faeff00-4548-4d46-83c3-01fc7cb9b8ca",
        "name": "RAG AI Agent1",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          -1268,
          450
        ]
      },
      {
        "parameters": {
          "public": true,
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.1,
        "position": [
          -1520,
          450
        ],
        "id": "6642becf-c156-4d4e-a4fa-e6385c26cff7",
        "name": "When chat message received",
        "webhookId": "53769069-bf2e-499e-9318-be0db240453b",
        "disabled": true
      },
      {
        "parameters": {},
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          -1180,
          670
        ],
        "id": "82c350cc-f6f4-42d1-b11b-53d82408416a",
        "name": "Postgres Chat Memory",
        "credentials": {
          "postgres": {
            "id": "EzZYFEVPXxVDpNLe",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "mode": "retrieve-as-tool",
          "toolName": "user_documents",
          "toolDescription": "Vector Store with a large collection of verified documents",
          "tableName": {
            "__rl": true,
            "value": "documents",
            "mode": "list",
            "cachedResultName": "documents"
          },
          "topK": 40,
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1,
        "position": [
          -1060,
          672.5
        ],
        "id": "347d5414-fd2c-4ece-9f5a-1901525951a5",
        "name": "user_documents",
        "credentials": {
          "supabaseApi": {
            "id": "1Yc1VOr8K1yXCO1Q",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "mode": "markdownToHtml",
          "markdown": "={{ $('Get Site').first().json.research }}",
          "options": {}
        },
        "type": "n8n-nodes-base.markdown",
        "typeVersion": 1,
        "position": [
          -44,
          -475
        ],
        "id": "a5b467f1-1171-48ff-a075-74eb1a37f603",
        "name": "Research HTML"
      },
      {
        "parameters": {
          "name": "monumentos_portugal",
          "description": "Query this tool to get knowledge of buildings and monuments only. Call the tool by the name of the buildin/monument and the city name to get response from http://www.monumentos.gov.pt/ - the official Portuguese source for information about monuments",
          "workflowId": {
            "__rl": true,
            "value": "y3SEoNbyzFsiZXtw",
            "mode": "list",
            "cachedResultName": "My project ‚Äî Content Monumentos Portugal"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          }
        },
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 2,
        "position": [
          -1520,
          910
        ],
        "id": "3ca45fe3-b74a-42d5-a959-0d177107fede",
        "name": "monumentos_portugal"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.name }} in {{ $('Get Sitename').first().json.city_id.toTitleCase() }}\n\n\n# Main research\n{{ $('Get Site').first().json.research }}",
          "hasOutputParser": true,
          "messages": {
            "messageValues": [
              {
                "message": "=# Role \nAs chief editor integrated with Heritage Navigator, synthesize multi-agent inputs into a unified narrative that balances academic depth with public accessibility, optimized for our target demographics (cultural tourists 45-70, educators, and local history enthusiasts).\nYou need to prioritize which topics from the research you want to emphasize in order to create a story that is as engaging as possible for the target audience.\nOnly use the knowledge from the provided research material. Don't use your own knowled about the subject.\n\n**Friendly and Engaging**\nUse a warm, welcoming style that treats the reader like a valued guest.\nKeep sentences shorter and use inclusive language such as ‚Äúwe‚Äù and ‚Äúus‚Äù to build rapport.\nEncourage curiosity about historical or cultural details without overwhelming the reader with jargon.\nUse direct calls to action when relevant, like ‚ÄúDiscover,‚Äù ‚ÄúExplore,‚Äù or ‚ÄúImmerse yourself.‚Äù\nEngage emotions by highlighting the human stories behind the facts.\n\n# Input  \nIn-depth historical research \n\n# Output Specifications  \n_A multi-format narrative containing the sections:_  \n\n\n# Output Format\nYour final output must be a valid JSON object"
              }
            ]
          }
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.5,
        "position": [
          -640,
          -350
        ],
        "id": "76095179-56ea-48aa-b0f0-6fece0f112f4",
        "name": "Editor1"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "=anthropic/claude-3.7-sonnet",
            "mode": "id"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -600,
          220
        ],
        "id": "a1595741-6800-46aa-b419-b46192d08e6c",
        "name": "OpenAI Chat Model3",
        "credentials": {
          "openAiApi": {
            "id": "7oESUrXOypaiYfq2",
            "name": "openrouter"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "site_translations",
          "filters": {
            "conditions": [
              {
                "keyName": "site_id",
                "keyValue": "={{ $('site').item.json.site_id }}"
              },
              {
                "keyName": "language_code",
                "keyValue": "en"
              },
              {
                "keyName": "city_id",
                "keyValue": "={{ $json.city_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -860,
          -350
        ],
        "id": "6950a807-8180-45ba-a89e-42a70853451b",
        "name": "Get Sitename",
        "credentials": {
          "supabaseApi": {
            "id": "1Yc1VOr8K1yXCO1Q",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f005e12b-7a72-4f7d-b4ed-a652a82e5688",
                "name": "site_id",
                "value": "={{ $json.site_id }}",
                "type": "string"
              },
              {
                "id": "fb770e5a-4a1a-4025-be59-3da22bf93564",
                "name": "city_id",
                "value": "rome",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -1300,
          -350
        ],
        "id": "676e830f-93ad-4a59-93ac-f0e91e8a41cf",
        "name": "site"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "sites",
          "filters": {
            "conditions": [
              {
                "keyName": "id",
                "keyValue": "={{ $json.site_id }}"
              },
              {
                "keyName": "city_id",
                "keyValue": "={{ $json.city_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -1080,
          -350
        ],
        "id": "225895ea-0df6-4538-bfbd-d83286958bc2",
        "name": "Get Site",
        "credentials": {
          "supabaseApi": {
            "id": "1Yc1VOr8K1yXCO1Q",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "claude-3-5-sonnet-20241022",
            "mode": "list",
            "cachedResultName": "Claude 3.5 Sonnet (New)"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
        "typeVersion": 1.3,
        "position": [
          -620,
          -60
        ],
        "id": "71c1acbe-fcb3-437d-b854-989a657cd1c8",
        "name": "Anthropic Chat Model1",
        "credentials": {
          "anthropicApi": {
            "id": "ADl7Wvu9YXxKvVtY",
            "name": "Anthropic account 2"
          }
        }
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4.1",
            "mode": "list",
            "cachedResultName": "gpt-4.1"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          -780,
          -100
        ],
        "id": "b2605515-16af-4dc2-af10-6615a8d58892",
        "name": "OpenAI Chat Model2",
        "credentials": {
          "openAiApi": {
            "id": "ZjiR1Y4tdzymEK1L",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "site_id"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -1500,
          -600
        ],
        "id": "a1fdd9ff-ca08-463e-8db5-ec3dac2e2292",
        "name": "When Executed by Another Workflow"
      }
    ],
    "connections": {
      "Gmail": {
        "main": [
          [
            {
              "node": "Check Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "Check Feedback",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "Research HTML",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Feedback": {
        "main": [
          [],
          [
            {
              "node": "Rejected",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Content Revision",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Content Revision": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI1": {
        "ai_embedding": [
          [
            {
              "node": "user_documents",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Structured Output Parser1": {
        "ai_outputParser": [
          [
            {
              "node": "Content Revision",
              "type": "ai_outputParser",
              "index": 0
            },
            {
              "node": "Editor1",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "RAG AI Agent1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "When chat message received": {
        "main": [
          [
            {
              "node": "RAG AI Agent1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "RAG AI Agent1",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "user_documents": {
        "ai_tool": [
          [
            {
              "node": "RAG AI Agent1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "monumentos_portugal": {
        "ai_tool": [
          []
        ]
      },
      "Editor1": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Research HTML": {
        "main": [
          [
            {
              "node": "Publish",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model3": {
        "ai_languageModel": [
          [
            {
              "node": "Content Revision",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get Sitename": {
        "main": [
          [
            {
              "node": "Editor1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "site": {
        "main": [
          [
            {
              "node": "Get Site",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Site": {
        "main": [
          [
            {
              "node": "Get Sitename",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Anthropic Chat Model1": {
        "ai_languageModel": [
          []
        ]
      },
      "OpenAI Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "Editor1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "site",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null,
    "autosaved": false
  },
  "tags": [
    {
      "updatedAt": "2025-01-28T15:25:26.214Z",
      "createdAt": "2025-01-28T15:25:26.214Z",
      "id": "BngebX50Ev8rBclu",
      "name": "HN Content manager"
    }
  ]
}